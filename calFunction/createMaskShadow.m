function [BW,maskedImage] = createMaskShadow(RGB)
%segmentImage Segment image using auto-generated code from imageSegmenter app
%  [BW,MASKEDIMAGE] = segmentImage(RGB) segments image RGB using
%  auto-generated code from the imageSegmenter app. The final segmentation
%  is returned in BW, and a masked image is returned in MASKEDIMAGE.

% Auto-generated by imageSegmenter app on 01-Mar-2019
%----------------------------------------------------


% Convert RGB image into L*a*b* color space.
X = rgb2lab(RGB);

% Graph cut
foregroundInd = [10557894 10557908 10557912 10557930 10557943 10557948 10557952 10558002 10558011 10558020 10573876 10573881 10573890 10574051 10594069 10630114 10666149 10702185 10774257 10810288 10882342 10950373 10969997 11022400 11130015 11130423 11130427 11222454 11310037 11310472 11454051 11526485 11614481 11670064 11670481 11830476 11846069 11954472 12046069 12134467 12258459 12278055 12438055 12458436 12582046 12618409 12670042 12706378 12762042 12834033 12834329 12922270 12958020 12978230 13014011 13030203 13066149 13066158 13066172 13082006 13082136 13102006 13102118 13138006 13138064 13154028 ];
backgroundInd = [9053894 9089616 9106208 9162512 9213567 9214544 9641455 9661455 9842705 9965455 10521513 10557527 10629558 10645670 10665612 10681643 10701666 10701675 10701679 10701693 10918839 11469822 11470866 11669840 11757849 11777849 11845849 11989854 12169854 12221854 12294848 12437854 12921831 13261800 13406794 13709782 14178750 14214750 14250745 14677791 14910494 14946467 15053827 15145863 15233930 15270217 15286015 15322091 ];
L = superpixels(X,120100,'IsInputLab',true);

% Convert L*a*b* range to [0 1]
scaledX = prepLab(X);
BW = lazysnapping(scaledX,L,foregroundInd,backgroundInd);

% Create masked image.
maskedImage = RGB;
maskedImage(repmat(~BW,[1 1 3])) = 0;
end

function out = prepLab(in)

% Convert L*a*b* image to range [0,1]
out = in;
out(:,:,1)   = in(:,:,1) / 100;  % L range is [0 100].
out(:,:,2:3) = (in(:,:,2:3) + 100) / 200;  % a* and b* range is [-100,100].

end
